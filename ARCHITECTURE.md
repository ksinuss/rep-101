# 🏗️ Архитектура Coworking Platform

## Общая схема системы

```
┌─────────────────────────────────────────────────────────────────┐
│                        COWORKING PLATFORM                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    HTTP/HTTPS    ┌─────────────────────┐  │
│  │   FRONTEND      │◄─────────────────►│     BACKEND         │  │
│  │   (React)       │                  │     (FastAPI)       │  │
│  │                 │                  │                     │  │
│  │ ┌─────────────┐ │                  │ ┌─────────────────┐ │  │
│  │ │   App.jsx   │ │                  │ │   main.py       │ │  │
│  │ └─────────────┘ │                  │ └─────────────────┘ │  │
│  │ ┌─────────────┐ │                  │ ┌─────────────────┐ │  │
│  │ │ API Service │ │                  │ │   Routers       │ │  │
│  │ └─────────────┘ │                  │ │   - auth        │ │  │
│  │ ┌─────────────┐ │                  │ │   - users       │ │  │
│  │ │ Components  │ │                  │ │   - visits      │ │  │
│  │ │ - Login     │ │                  │ │   - donations   │ │  │
│  │ │ - Register  │ │                  │ │   - admin       │ │  │
│  │ │ - Profile   │ │                  │ └─────────────────┘ │  │
│  │ │ - MainWindow│ │                  │ ┌─────────────────┐ │  │
│  │ └─────────────┘ │                  │ │   Database      │ │  │
│  └─────────────────┘                  │ │   (SQLite)      │ │  │
│                                       │ └─────────────────┘ │  │
└─────────────────────────────────────────────────────────────────┘
```

## Детальная архитектура

### Frontend Layer (React)
```
┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND (React 19)                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   App.jsx   │  │ API Service │  │ Components  │        │
│  │             │  │             │  │             │        │
│  │ - State     │  │ - HTTP      │  │ - Login     │        │
│  │ - Routing   │  │ - Auth      │  │ - Register  │        │
│  │ - Auth      │  │ - Error     │  │ - Profile   │        │
│  │             │  │   Handling  │  │ - MainWindow│        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   Styling   │  │   Utils     │  │   Assets    │        │
│  │             │  │             │  │             │        │
│  │ - Tailwind  │  │ - Helpers   │  │ - Images    │        │
│  │ - CSS       │  │ - Constants │  │ - Icons     │        │
│  │             │  │             │  │             │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

### Backend Layer (FastAPI)
```
┌─────────────────────────────────────────────────────────────┐
│                    BACKEND (FastAPI)                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   main.py   │  │   Routers   │  │   Models    │        │
│  │             │  │             │  │             │        │
│  │ - FastAPI   │  │ - auth.py   │  │ - User      │        │
│  │ - CORS      │  │ - users.py  │  │ - Visit     │        │
│  │ - Middleware│  │ - visits.py │  │ - Donation  │        │
│  │             │  │ - donations │  │             │        │
│  │             │  │ - admin.py  │  │             │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   CRUD      │  │   Security  │  │   Database  │        │
│  │             │  │             │  │             │        │
│  │ - User CRUD │  │ - JWT       │  │ - SQLite    │        │
│  │ - Visit CRUD│  │ - Password  │  │ - SQLAlchemy│        │
│  │ - Donation  │  │   Hashing   │  │ - Sessions  │        │
│  │   CRUD      │  │             │  │             │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

### Database Schema
```
┌─────────────────────────────────────────────────────────────┐
│                    DATABASE (SQLite)                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  USERS TABLE                        │   │
│  │                                                     │   │
│  │  id (PK) │ email │ password │ full_name │ karma    │   │
│  │  is_admin│ total_donated │ created_at │ is_active │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                │
│                           │ 1:N                            │
│                           ▼                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                 VISITS TABLE                        │   │
│  │                                                     │   │
│  │  id (PK) │ user_id (FK) │ check_in │ check_out     │   │
│  │  duration_minutes                                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                │
│                           │ 1:N                            │
│                           ▼                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │               DONATIONS TABLE                       │   │
│  │                                                     │   │
│  │  id (PK) │ user_id (FK) │ amount │ message         │   │
│  │  donation_date │ is_anonymous                       │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## Поток данных

### 1. Регистрация пользователя
```
User → Frontend → API Service → Backend → Database
  ↓
User ← Frontend ← API Service ← Backend ← Database
```

### 2. Аутентификация
```
User → Frontend → API Service → Backend → JWT Token
  ↓
User ← Frontend ← API Service ← Backend ← JWT Token
```

### 3. Получение данных
```
User → Frontend → API Service → Backend → Database
  ↓
User ← Frontend ← API Service ← Backend ← Database
```

## Технологический стек

### Frontend
- **React 19** - UI библиотека
- **Vite 7** - сборщик
- **Tailwind CSS 4** - стилизация
- **ESLint** - линтер

### Backend
- **FastAPI** - веб-фреймворк
- **SQLAlchemy** - ORM
- **SQLite** - база данных
- **JWT** - аутентификация
- **Pydantic** - валидация
- **Uvicorn** - ASGI сервер

### Инфраструктура
- **Docker** - контейнеризация
- **Git** - контроль версий
- **npm/pip** - менеджеры пакетов

## Безопасность

### Аутентификация
- JWT токены с истечением срока действия
- Хеширование паролей с bcrypt
- Защита от CSRF атак

### Авторизация
- Роли пользователей (user/admin)
- Проверка прав доступа на уровне API
- Защищенные маршруты

### Валидация
- Валидация входных данных с Pydantic
- Защита от SQL injection через ORM
- CORS настройки

## Масштабируемость

### Горизонтальное масштабирование
- Stateless backend
- Внешняя база данных
- Load balancer

### Вертикальное масштабирование
- Оптимизация запросов
- Кэширование
- Индексы базы данных

## Мониторинг

### Логирование
- Структурированные логи
- Уровни логирования
- Централизованное логирование

### Метрики
- Производительность API
- Использование ресурсов
- Ошибки и исключения
