# Student Coworking Platform - Backend

Backend API для платформы студенческого коворкинга с возможностью бронирования аудиторий.

## Функциональность

### Основные возможности
- **Аутентификация пользователей** - регистрация, вход, JWT токены
- **Управление пользователями** - профили, карма, статистика
- **Посещения коворкинга** - check-in/check-out, отслеживание времени
- **Система пожертвований** - поддержка коворкинга
- **Бронирование аудиторий** - новая функциональность!

### Бронирование аудиторий
- Создание и управление аудиториями (для администраторов)
- Просмотр доступных слотов времени
- Бронирование аудиторий пользователями
- Отмена бронирований
- Проверка конфликтов времени
- Система кармы за бронирования

## API Endpoints

### Аутентификация
- `POST /auth/register` - Регистрация пользователя
- `POST /auth/login` - Вход в систему
- `GET /users/me` - Получение текущего пользователя

### Аудитории
- `GET /api/rooms` - Список всех аудиторий
- `GET /api/rooms/{id}` - Информация об аудитории
- `POST /api/rooms` - Создание аудитории (админ)
- `PUT /api/rooms/{id}` - Обновление аудитории (админ)
- `DELETE /api/rooms/{id}` - Удаление аудитории (админ)
- `GET /api/rooms/{id}/availability` - Доступные слоты времени
- `GET /api/rooms/{id}/bookings` - Бронирования аудитории

### Бронирования
- `POST /api/bookings` - Создание бронирования
- `GET /api/bookings` - Список всех бронирований (админ) или своих
- `GET /api/bookings/my` - Мои бронирования
- `GET /api/bookings/{id}` - Информация о бронировании
- `PUT /api/bookings/{id}` - Обновление бронирования
- `DELETE /api/bookings/{id}` - Отмена бронирования

### Другие endpoints
- `POST /visits/check-in` - Начало посещения
- `POST /visits/{id}/check-out` - Завершение посещения
- `POST /donations` - Создание пожертвования
- `GET /admin/dashboard` - Статистика (админ)

## Установка и запуск

### Требования
- Python 3.8+
- SQLite (или PostgreSQL для продакшена)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Настройка окружения
Создайте файл `.env` в корне проекта:
```env
DATABASE_URL=sqlite:///./coworking.db
SECRET_KEY=your-secret-key-here
```

### Инициализация базы данных
```bash
# Создание таблиц и тестовых аудиторий
python init_rooms.py
```

### Запуск сервера
```bash
# Разработка
python start_server.py

# Или напрямую
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## Модели данных

### Room (Аудитория)
- `id` - Уникальный идентификатор
- `name` - Название аудитории
- `description` - Описание
- `capacity` - Вместимость
- `equipment` - Оборудование (JSON строка)
- `is_active` - Активна ли аудитория
- `created_at` - Дата создания

### Booking (Бронирование)
- `id` - Уникальный идентификатор
- `user_id` - ID пользователя
- `room_id` - ID аудитории
- `start_time` - Время начала
- `end_time` - Время окончания
- `purpose` - Цель бронирования
- `status` - Статус (confirmed, cancelled, completed)
- `created_at` - Дата создания
- `updated_at` - Дата обновления

## Особенности реализации

### Проверка конфликтов
Система автоматически проверяет конфликты времени при создании бронирований.

### Система кармы
- +2 кармы за каждое бронирование
- +1 карма за посещение коворкинга
- Карма за пожертвования (1 карма за каждые 50 рублей)

### Валидация времени
- Нельзя бронировать аудитории в прошлом
- Время окончания должно быть позже времени начала
- Слоты времени: 1 час, с 9:00 до 21:00

## Разработка

### Структура проекта
```
app/
├── __init__.py
├── main.py              # Основное приложение FastAPI
├── database.py          # Настройки базы данных
├── models.py            # SQLAlchemy модели
├── schemas.py           # Pydantic схемы
├── crud.py              # CRUD операции
├── routers/             # API роутеры
│   ├── auth.py
│   ├── users.py
│   ├── visits.py
│   ├── donations.py
│   ├── rooms.py         # Новый роутер для аудиторий
│   ├── bookings.py      # Новый роутер для бронирований
│   └── admin.py
└── utils/
    └── security.py      # Утилиты безопасности
```

### Добавление новых функций
1. Создайте модель в `models.py`
2. Добавьте схемы в `schemas.py`
3. Реализуйте CRUD операции в `crud.py`
4. Создайте роутер в `routers/`
5. Подключите роутер в `main.py`

## Лицензия

MIT License
