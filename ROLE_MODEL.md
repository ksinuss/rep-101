# Ролевая модель - Student Coworking Platform

## Обзор

Данный документ описывает ролевую модель, роли пользователей и их права доступа в системе управления студенческим коворкингом.

## Роли пользователей

### 1. Гость (Guest)
**Описание**: Неавторизованный пользователь  
**Статус**: Временная роль до регистрации/входа

**Права доступа:**
- ✅ Просмотр главной страницы
- ✅ Регистрация в системе
- ✅ Вход в систему
- ❌ Доступ к личному кабинету
- ❌ Бронирование аудиторий
- ❌ Просмотр сообщества

### 2. Пользователь (User)
**Описание**: Обычный участник коворкинга  
**Статус**: Базовая роль после регистрации

**Права доступа:**
- ✅ Просмотр и редактирование личного профиля
- ✅ Бронирование аудиторий
- ✅ Просмотр своих бронирований
- ✅ Отмена своих бронирований
- ✅ Просмотр доступных слотов времени
- ✅ Создание и управление посещениями (check-in/check-out)
- ✅ Создание пожертвований
- ✅ Просмотр сообщества
- ✅ Создание постов в сообществе
- ✅ Просмотр статистики своих посещений и пожертвований
- ❌ Управление аудиториями
- ❌ Просмотр всех пользователей
- ❌ Административные функции

### 3. Администратор (Admin)
**Описание**: Управляющий коворкингом  
**Статус**: Расширенная роль с полными правами

**Права доступа:**
- ✅ Все права пользователя
- ✅ Создание аудиторий
- ✅ Редактирование аудиторий
- ✅ Удаление аудиторий
- ✅ Просмотр всех бронирований
- ✅ Отмена любых бронирований
- ✅ Просмотр всех пользователей
- ✅ Управление пользователями
- ✅ Просмотр административной панели
- ✅ Доступ к аналитике и статистике
- ✅ Управление системными настройками

## Детальное описание прав

### Аутентификация и авторизация
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Регистрация | ✅ | ❌ | ❌ |
| Вход в систему | ✅ | ✅ | ✅ |
| Выход из системы | ❌ | ✅ | ✅ |
| Смена пароля | ❌ | ✅ | ✅ |

### Управление профилем
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Просмотр своего профиля | ❌ | ✅ | ✅ |
| Редактирование своего профиля | ❌ | ✅ | ✅ |
| Просмотр профилей других пользователей | ❌ | ❌ | ✅ |
| Редактирование профилей других пользователей | ❌ | ❌ | ✅ |

### Аудитории
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Просмотр списка аудиторий | ❌ | ✅ | ✅ |
| Просмотр деталей аудитории | ❌ | ✅ | ✅ |
| Создание аудитории | ❌ | ❌ | ✅ |
| Редактирование аудитории | ❌ | ❌ | ✅ |
| Удаление аудитории | ❌ | ❌ | ✅ |
| Просмотр доступности аудитории | ❌ | ✅ | ✅ |

### Бронирования
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Создание бронирования | ❌ | ✅ | ✅ |
| Просмотр своих бронирований | ❌ | ✅ | ✅ |
| Просмотр всех бронирований | ❌ | ❌ | ✅ |
| Редактирование своего бронирования | ❌ | ✅ | ✅ |
| Редактирование любых бронирований | ❌ | ❌ | ✅ |
| Отмена своего бронирования | ❌ | ✅ | ✅ |
| Отмена любых бронирований | ❌ | ❌ | ✅ |

### Посещения
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Check-in (начало посещения) | ❌ | ✅ | ✅ |
| Check-out (завершение посещения) | ❌ | ✅ | ✅ |
| Просмотр своих посещений | ❌ | ✅ | ✅ |
| Просмотр всех посещений | ❌ | ❌ | ✅ |

### Пожертвования
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Создание пожертвования | ❌ | ✅ | ✅ |
| Просмотр своих пожертвований | ❌ | ✅ | ✅ |
| Просмотр всех пожертвований | ❌ | ❌ | ✅ |

### Сообщество
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Просмотр постов | ❌ | ✅ | ✅ |
| Создание постов | ❌ | ✅ | ✅ |
| Редактирование своих постов | ❌ | ✅ | ✅ |
| Удаление своих постов | ❌ | ✅ | ✅ |
| Удаление любых постов | ❌ | ❌ | ✅ |

### Административные функции
| Действие | Гость | Пользователь | Администратор |
|----------|-------|--------------|---------------|
| Доступ к админ-панели | ❌ | ❌ | ✅ |
| Просмотр статистики | ❌ | ❌ | ✅ |
| Управление пользователями | ❌ | ❌ | ✅ |
| Системные настройки | ❌ | ❌ | ✅ |
| Экспорт данных | ❌ | ❌ | ✅ |

## Система кармы

### Начисление кармы
| Действие | Количество кармы |
|----------|------------------|
| Посещение коворкинга (check-in) | +1 |
| Бронирование аудитории | +2 |
| Пожертвование (за каждые 50₽) | +1 |
| Создание поста в сообществе | +1 |

### Использование кармы
- Карма отображается в профиле пользователя
- Высокая карма может давать приоритет при бронировании (планируется)
- Карма влияет на рейтинг в сообществе

## Ограничения и правила

### Временные ограничения
- **Бронирование аудиторий**: максимум 4 часа подряд
- **Отмена бронирования**: не позднее чем за 2 часа до начала
- **Повторное бронирование**: не более 3 активных бронирований одновременно

### Ограничения по времени работы
- **Бронирование**: с 9:00 до 21:00
- **Слоты времени**: по 1 часу
- **Рабочие дни**: понедельник - пятница

### Ограничения по аудиториям
- **Конференц-залы**: минимум 2 человека для бронирования
- **Переговорные**: без ограничений по количеству
- **Коворкинг-зона**: только для индивидуальной работы

## Безопасность и валидация

### Проверки при бронировании
- ✅ Проверка доступности времени
- ✅ Проверка прав пользователя
- ✅ Валидация данных формы
- ✅ Проверка лимитов пользователя

### Проверки при управлении
- ✅ Проверка роли администратора
- ✅ Валидация входных данных
- ✅ Проверка существования ресурсов
- ✅ Логирование административных действий

## Расширение ролевой модели

### Планируемые роли

#### Модератор (Moderator)
**Описание**: Помощник администратора с ограниченными правами  
**Права:**
- Все права пользователя
- Модерация постов в сообществе
- Просмотр статистики посещений
- Управление бронированиями (без создания аудиторий)

#### Премиум-пользователь (Premium User)
**Описание**: Пользователь с расширенными возможностями  
**Права:**
- Все права пользователя
- Приоритетное бронирование
- Увеличенные лимиты бронирований
- Доступ к премиум-аудиториям

### Гибкая система прав
В будущем планируется реализация системы настраиваемых прав, где администратор сможет:
- Создавать кастомные роли
- Настраивать права для каждой роли
- Назначать роли пользователям
- Управлять временными правами

## Реализация в коде

### Backend (FastAPI)
```python
# Проверка роли в декораторах
@router.get("/admin/dashboard")
async def get_dashboard(current_user: User = Depends(get_current_admin_user)):
    # Только для администраторов
    pass

# Проверка прав в CRUD операциях
def create_room(db: Session, room: RoomCreate, current_user: User):
    if not current_user.is_admin:
        raise HTTPException(status_code=403, detail="Admin access required")
    # Создание аудитории
```

### Frontend (React)
```javascript
// Условное отображение элементов
{user?.isAdmin && (
  <button onClick={() => setShowAdminPanel(true)}>
    Админ-панель
  </button>
)}

// Проверка прав в компонентах
const canEditRoom = user?.isAdmin;
const canCancelBooking = booking.user_id === user?.id || user?.isAdmin;
```

## Мониторинг и аудит

### Логирование действий
- Все административные действия логируются
- Отслеживание попыток несанкционированного доступа
- Мониторинг изменений в системе

### Аналитика использования
- Статистика по ролям пользователей
- Анализ активности по типам действий
- Отчеты по использованию прав

---

*Документ актуален на: [текущая дата]*  
*Версия: 1.0*  
*Автор: Development Team*
